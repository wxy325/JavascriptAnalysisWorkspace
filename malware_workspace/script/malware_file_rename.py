

import os
import shutil

script_dir = os.path.dirname(os.path.realpath(__file__))
ds_dir_base = os.path.join(script_dir, '../data/js-malicious-dataset')
ds_output_dir = os.path.join(script_dir, '../data/js-malicious-dataset-renamed')

if __name__ == '__main__':
    if not os.path.exists(ds_output_dir):
        os.mkdir(ds_output_dir)

    dir_list = os.listdir(ds_dir_base)
    for dir_base in dir_list:
        full_dir_base = os.path.join(ds_dir_base, dir_base)
        out_dir_base = os.path.join(ds_output_dir, dir_base)
        if not os.path.exists(out_dir_base):
            os.mkdir(out_dir_base)

        index = 0
        for root, dirs, files in os.walk(full_dir_base):
            for f in files:
                out_name = "{0:04}.html".format(index)
                out_full_path = os.path.join(out_dir_base, out_name)

                file_full_path = os.path.join(root, f)
                if f.endswith('.html'):
                    shutil.copy(file_full_path, out_full_path)
                    index += 1
                elif f.endswith('.js'):
                    with open(file_full_path) as f:
                        content = f.read()

                    html_pre = '''
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
                    '''
                    html_post = '''
</script>
</body>
</html>
                    '''
                    full_content = html_pre + content + html_post

                    with open(out_full_path,'w') as f:
                        f.write(full_content)
                    index += 1
                    pass
